openapi: 3.0.3
info:
  title: CSMS API
  description: Coin Security Management System API
  version: 1.0.0
  contact:
    name: CSMS Support
    email: support@csms.com

servers:
  - url: http://localhost:8080/api/v1
    description: Local development server
  - url: https://api.csms.com/api/v1
    description: Production server

tags:
  - name: Auth
    description: 인증 관련 API
  - name: Admin
    description: 관리자 API
  - name: User
    description: 사용자 API
  - name: Currency
    description: 통화 API

paths:
  /admin/auth/login:
    post:
      tags:
        - Admin
      summary: 관리자 로그인
      description: 관리자 계정으로 로그인합니다.
      operationId: adminLogin
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - id
                - password
              properties:
                id:
                  type: string
                  description: 관리자 ID
                  example: admin1
                password:
                  type: string
                  format: password
                  description: 관리자 비밀번호
                  example: admin_password
      responses:
        '200':
          description: 로그인 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              example:
                status: OK
                message: 요청이 완료되었습니다.
                data:
                  accessToken: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
                  adminId: admin1
        '400':
          description: 잘못된 요청
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: 인증 실패
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /admin/dashboard:
    get:
      tags:
        - Admin
      summary: 관리자 대시보드 통계 조회
      description: 관리자 대시보드의 통계 데이터를 조회합니다.
      operationId: getAdminDashboard
      security:
        - bearerAuth: []
      parameters:
        - name: dateRange
          in: query
          description: 조회 기간
          required: false
          schema:
            type: string
            enum: [7, 14, 30, 180, 365, custom]
            default: 7
        - name: startDate
          in: query
          description: 시작 날짜 (YYYY-MM-DD) - dateRange가 custom일 때 필수
          required: false
          schema:
            type: string
            format: date
        - name: endDate
          in: query
          description: 종료 날짜 (YYYY-MM-DD) - dateRange가 custom일 때 필수
          required: false
          schema:
            type: string
            format: date
      responses:
        '200':
          description: 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DashboardResponse'
        '401':
          description: 인증 필요
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: 권한 없음
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /admin/members:
    get:
      tags:
        - Admin
      summary: 회원 목록 조회
      description: 회원 목록을 검색, 필터링, 페이지네이션하여 조회합니다.
      operationId: getAdminMembers
      security:
        - bearerAuth: []
      parameters:
        - name: limit
          in: query
          description: 페이지당 항목 수
          required: false
          schema:
            type: integer
            default: 20
        - name: offset
          in: query
          description: 시작 위치
          required: false
          schema:
            type: integer
            default: 0
        - name: searchCategory
          in: query
          description: 검색 카테고리
          required: false
          schema:
            type: string
            enum: [ALL, ID, REFERRER, NICKNAME, EMAIL, LEVEL, INVITATION_CODE]
        - name: searchKeyword
          in: query
          description: 검색어 (최대 20자)
          required: false
          schema:
            type: string
            maxLength: 20
        - name: activityStatus
          in: query
          description: 활동상태 필터
          required: false
          schema:
            type: string
            enum: [ALL, ACTIVE, INACTIVE]
        - name: sanctionStatus
          in: query
          description: 제재상태 필터
          required: false
          schema:
            type: string
            enum: [ALL, WARNING, MINING_SUSPENDED, ACCOUNT_BLOCKED]
      responses:
        '200':
          description: 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MemberListResponse'
        '401':
          description: 인증 필요
        '403':
          description: 권한 없음

  /admin/members/{id}:
    get:
      tags:
        - Admin
      summary: 회원 상세 정보 조회
      description: 특정 회원의 상세 정보를 조회합니다.
      operationId: getAdminMemberDetail
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: 회원 ID
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MemberDetailResponse'
        '401':
          description: 인증 필요
        '404':
          description: 회원을 찾을 수 없음

  /admin/members/{id}/sanction:
    patch:
      tags:
        - Admin
      summary: 회원 제재 적용/해제
      description: 회원에게 제재를 적용하거나 해제합니다.
      operationId: updateMemberSanction
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: 회원 ID
          schema:
            type: integer
            format: int64
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SanctionRequest'
      responses:
        '200':
          description: 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '401':
          description: 인증 필요
        '404':
          description: 회원을 찾을 수 없음

  /admin/members/export:
    get:
      tags:
        - Admin
      summary: 회원 목록 엑셀 다운로드
      description: 회원 목록을 엑셀 또는 CSV 파일로 다운로드합니다.
      operationId: exportAdminMembers
      security:
        - bearerAuth: []
      parameters:
        - name: searchCategory
          in: query
          description: 검색 카테고리
          required: false
          schema:
            type: string
            enum: [ALL, ID, REFERRER, NICKNAME, EMAIL, LEVEL, INVITATION_CODE]
        - name: searchKeyword
          in: query
          description: 검색어
          required: false
          schema:
            type: string
        - name: activityStatus
          in: query
          description: 활동상태 필터
          required: false
          schema:
            type: string
            enum: [ALL, ACTIVE, INACTIVE]
        - name: sanctionStatus
          in: query
          description: 제재상태 필터
          required: false
          schema:
            type: string
            enum: [ALL, WARNING, MINING_SUSPENDED, ACCOUNT_BLOCKED]
      responses:
        '200':
          description: 성공
          content:
            application/vnd.openxmlformats-officedocument.spreadsheetml.sheet:
              schema:
                type: string
                format: binary
        '401':
          description: 인증 필요

  /users/register:
    post:
      tags:
        - User
      summary: 사용자 회원가입
      description: 새로운 사용자를 등록합니다.
      operationId: registerUser
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - loginId
                - password
              properties:
                loginId:
                  type: string
                  minLength: 3
                  maxLength: 50
                  example: testuser
                password:
                  type: string
                  format: password
                  minLength: 8
                  maxLength: 20
                  example: password123
      responses:
        '200':
          description: 회원가입 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '400':
          description: 잘못된 요청
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /users/login:
    post:
      tags:
        - User
      summary: 사용자 로그인
      description: 사용자 계정으로 로그인합니다.
      operationId: userLogin
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - loginId
                - password
              properties:
                loginId:
                  type: string
                  example: testuser
                password:
                  type: string
                  format: password
                  example: password123
      responses:
        '200':
          description: 로그인 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '401':
          description: 인증 실패
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /users/{id}:
    get:
      tags:
        - User
      summary: 사용자 조회
      description: 사용자 정보를 조회합니다.
      operationId: getUser
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: 사용자 ID
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
        '401':
          description: 인증 필요
        '404':
          description: 사용자를 찾을 수 없음

  /currencies:
    get:
      tags:
        - Currency
      summary: 통화 목록 조회
      description: 활성화된 통화 목록을 조회합니다.
      operationId: getCurrencies
      responses:
        '200':
          description: 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT 토큰을 Authorization 헤더에 포함하세요. 예: Bearer {token}

  schemas:
    ApiResponse:
      type: object
      properties:
        status:
          type: string
          example: OK
        message:
          type: string
          example: 요청이 완료되었습니다.
        data:
          type: object
          description: 응답 데이터

    ErrorResponse:
      type: object
      properties:
        status:
          type: string
          example: ERROR
        message:
          type: string
          example: 에러 메시지
        code:
          type: integer
          example: 400

    AdminLoginResponse:
      type: object
      properties:
        accessToken:
          type: string
          example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
        adminId:
          type: string
          example: admin1

    DashboardResponse:
      type: object
      properties:
        status:
          type: string
          example: OK
        message:
          type: string
          example: 요청이 완료되었습니다.
        data:
          type: object
          properties:
            stats:
              $ref: '#/components/schemas/DashboardStats'
            chartData:
              type: array
              items:
                $ref: '#/components/schemas/ChartData'
            topMembers:
              type: array
              items:
                $ref: '#/components/schemas/TopMember'
            notifications:
              type: array
              items:
                $ref: '#/components/schemas/Notification'
            topReferrers:
              type: array
              items:
                $ref: '#/components/schemas/TopReferrer'

    DashboardStats:
      type: object
      properties:
        totalIssuance:
          type: number
          format: double
          example: 5000000000.0
        totalMined:
          type: number
          format: double
          example: 1000.0
        todayDepositCount:
          type: integer
          example: 100
        todayPaymentCount:
          type: integer
          example: 100
        todayExchangeCount:
          type: integer
          example: 100
        todayWithdrawalCount:
          type: integer
          example: 100
        totalMiningAmount:
          type: number
          format: double
          example: 1000.0
        totalPaymentAmount:
          type: number
          format: double
          example: 1000.0
        totalExchangeAmount:
          type: number
          format: double
          example: 1000.0
        totalWithdrawalAmount:
          type: number
          format: double
          example: -1000.0
        totalWithdrawalFeeRevenue:
          type: number
          format: double
          example: 1000.0
        coinDepositCount:
          type: integer
          example: 100
        paymentDepositCount:
          type: integer
          example: 100
        swapCount:
          type: integer
          example: 100
        exchangeCount:
          type: integer
          example: 100
        withdrawalCount:
          type: integer
          example: 100
        realtimeMiningUsers:
          type: integer
          example: 100
        realtimeBroadcasts:
          type: integer
          example: 100
        realtimeListeners:
          type: integer
          example: 100
        referralRegistrationCount:
          type: integer
          example: 100
        totalUsers:
          type: integer
          example: 100

    ChartData:
      type: object
      properties:
        date:
          type: string
          format: date
          example: "2025-01-01"
        totalMined:
          type: number
          format: double
          example: 950.5
        userCount:
          type: integer
          example: 75

    TopMember:
      type: object
      properties:
        rank:
          type: integer
          example: 1
        nickname:
          type: string
          example: MONEY1
        minedAmount:
          type: number
          format: double
          example: 10.0

    Notification:
      type: object
      properties:
        id:
          type: integer
          format: int64
          example: 1
        type:
          type: string
          enum: [INQUIRY, WITHDRAWAL, ANOMALY]
          example: INQUIRY
        category:
          type: string
          example: 코인문의
        content:
          type: string
          example: 문의 내용
        createdAt:
          type: string
          format: date-time
          example: "2025-10-25T10:55:00"
        isRead:
          type: boolean
          example: false

    TopReferrer:
      type: object
      properties:
        rank:
          type: integer
          example: 1
        nickname:
          type: string
          example: MONEY
        teamMemberCount:
          type: integer
          example: 1000

    Currency:
      type: object
      properties:
        id:
          type: integer
          example: 1
        code:
          type: string
          example: TRX
        name:
          type: string
          example: TRON
        chain:
          type: string
          example: TRON
        isActive:
          type: boolean
          example: true
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    MemberListResponse:
      type: object
      properties:
        status:
          type: string
          example: OK
        message:
          type: string
          example: 요청이 완료되었습니다.
        data:
          type: object
          properties:
            members:
              type: array
              items:
                $ref: '#/components/schemas/MemberInfo'
            total:
              type: integer
              format: int64
            limit:
              type: integer
            offset:
              type: integer

    MemberInfo:
      type: object
      properties:
        id:
          type: integer
          format: int64
        loginId:
          type: string
        referrerId:
          type: integer
          format: int64
          nullable: true
        referrerNickname:
          type: string
          nullable: true
        nickname:
          type: string
        email:
          type: string
        level:
          type: integer
        invitationCode:
          type: string
        teamMemberCount:
          type: integer
        referralRevenue:
          type: number
          format: double
        totalMinedAmount:
          type: number
          format: double
        activityStatus:
          type: string
        sanctionStatus:
          type: string
          nullable: true
        registeredAt:
          type: string
          format: date-time

    MemberDetailResponse:
      type: object
      properties:
        status:
          type: string
          example: OK
        message:
          type: string
          example: 요청이 완료되었습니다.
        data:
          $ref: '#/components/schemas/MemberDetail'

    MemberDetail:
      type: object
      properties:
        id:
          type: integer
          format: int64
        loginId:
          type: string
        referrerId:
          type: integer
          format: int64
          nullable: true
        referrerNickname:
          type: string
          nullable: true
        nickname:
          type: string
        email:
          type: string
        level:
          type: integer
        invitationCode:
          type: string
        teamMemberCount:
          type: integer
        referralRevenue:
          type: number
          format: double
        totalMinedAmount:
          type: number
          format: double
        activityStatus:
          type: string
        sanctionStatus:
          type: string
          nullable: true
        gender:
          type: string
          nullable: true
        age:
          type: integer
          nullable: true
        realName:
          type: string
          nullable: true
        birthDate:
          type: string
          format: date
          nullable: true
        phone:
          type: string
          nullable: true
        kakaoId:
          type: string
          nullable: true
        registeredAt:
          type: string
          format: date-time
        hasPaymentHistory:
          type: boolean
        hasDepositHistory:
          type: boolean
        lastIpAddress:
          type: string
          nullable: true
        lastLoginAt:
          type: string
          format: date-time
          nullable: true
        wallets:
          type: array
          items:
            $ref: '#/components/schemas/WalletInfo'

    WalletInfo:
      type: object
      properties:
        id:
          type: integer
          format: int64
        currencyCode:
          type: string
        address:
          type: string
        balance:
          type: number
          format: double
        status:
          type: string

    SanctionRequest:
      type: object
      properties:
        sanctionStatus:
          type: string
          enum: [WARNING, MINING_SUSPENDED, ACCOUNT_BLOCKED]
          nullable: true
          description: 제재 상태 (null이면 해제)

